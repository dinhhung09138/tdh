
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Administrator/Views/Shared/_AdminLayout.cshtml";
}
@section header{

}
@Html.Action("modulenavigation", "base", new { @area = "administrator", @moduleCode = "user_info" })
<div class="card card-success">
    <div class="card-header with-border no-bg">
        <h3 class="card-title">Name</h3>
        <div class="card-tools pull-right">

        </div>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4 col-xs-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Latest Members</h3>
                        <div class="card-tools">
                            <span class="badge badge-danger">8 New Members</span>
                            <button type="button" class="btn btn-tool">
                                <i class="fa fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <ul class="users-list clearfix">
                            <li>
                                <img src="/Areas/Administrator/Content/dist/img/user1-128x128.jpg" alt="User Image">
                                <a class="users-list-name" href="#">Alexander Pierce</a>
                                <span class="users-list-date">Today</span>
                            </li>
                            <li>
                                <img src="/Areas/Administrator/Content/dist/img/user8-128x128.jpg" alt="User Image">
                                <a class="users-list-name" href="#">Norman Norman Norman Norman Norman Norman</a>
                                <span class="users-list-date">Yesterday</span>
                            </li>
                            <li>
                                <img src="/Areas/Administrator/Content/dist/img/user7-128x128.jpg" alt="User Image">
                                <a class="users-list-name" href="#">Jane</a>
                                <span class="users-list-date">12 Jan</span>
                            </li>
                            <li>
                                <img src="/Areas/Administrator/Content/dist/img/user3-128x128.jpg" alt="User Image">
                                <a class="users-list-name" href="#">Nadia</a>
                                <span class="users-list-date">15 Jan</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-xs-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recently Added Products</h3>
                        <div class="card-tools">
                            <span class="badge badge-danger">8 New Members</span>
                            <button type="button" class="btn btn-tool">
                                <i class="fa fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <ul class="products-list product-list-in-card pl-2 pr-2">
                            <li class="item">
                                <div class="product-img">
                                    <img src="/Areas/Administrator/Content/dist/img/default-150x150.png" alt="Product Image" class="img-size-50">
                                </div>
                                <div class="product-info">
                                    <a href="javascript:void(0)" class="product-title">
                                        Samsung TV
                                        <span class="badge badge-warning float-right">$1800</span>
                                    </a>
                                    <span class="product-description">
                                        Samsung 32" 1080p 60Hz LED Smart HDTV.
                                    </span>
                                </div>
                            </li>
                            <li class="item">
                                <div class="product-img">
                                    <img src="/Areas/Administrator/Content/dist/img/default-150x150.png" alt="Product Image" class="img-size-50">
                                </div>
                                <div class="product-info">
                                    <a href="javascript:void(0)" class="product-title">
                                        Bicycle
                                        <span class="badge badge-info float-right">$700</span>
                                    </a>
                                    <span class="product-description">
                                        26" Mongoose Dolomite Men's 7-speed, Navy Blue.
                                    </span>
                                </div>
                            </li>
                            <li class="item">
                                <div class="product-img">
                                    <img src="/Areas/Administrator/Content/dist/img/default-150x150.png" alt="Product Image" class="img-size-50">
                                </div>
                                <div class="product-info">
                                    <a href="javascript:void(0)" class="product-title">
                                        Xbox One <span class="badge badge-danger float-right">
                                            $350
                                        </span>
                                    </a>
                                    <span class="product-description">
                                        Xbox One Console Bundle with Halo Master Chief Collection.
                                    </span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-xs-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recently Added Products</h3>
                        <div class="card-tools">
                            <span class="badge badge-danger">8 New Members</span>
                            <button type="button" class="btn btn-tool">
                                <i class="fa fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <ul class="products-list product-list-in-card pl-2 pr-2">
                            <li class="item">
                                <div class="product-img">
                                    <img src="/Areas/Administrator/Content/dist/img/default-150x150.png" alt="Product Image" class="img-size-50">
                                </div>
                                <div class="product-info">
                                    <a href="javascript:void(0)" class="product-title">
                                        Samsung TV
                                        <span class="badge badge-warning float-right">$1800</span>
                                    </a>
                                    <span class="product-description">
                                        Samsung 32" 1080p 60Hz LED Smart HDTV.
                                    </span>
                                </div>
                            </li>
                            <li class="item">
                                <div class="product-img">
                                    <img src="/Areas/Administrator/Content/dist/img/default-150x150.png" alt="Product Image" class="img-size-50">
                                </div>
                                <div class="product-info">
                                    <a href="javascript:void(0)" class="product-title">
                                        Bicycle
                                        <span class="badge badge-info float-right">$700</span>
                                    </a>
                                    <span class="product-description">
                                        26" Mongoose Dolomite Men's 7-speed, Navy Blue.
                                    </span>
                                </div>
                            </li>
                            <li class="item">
                                <div class="product-img">
                                    <img src="/Areas/Administrator/Content/dist/img/default-150x150.png" alt="Product Image" class="img-size-50">
                                </div>
                                <div class="product-info">
                                    <a href="javascript:void(0)" class="product-title">
                                        Xbox One <span class="badge badge-danger float-right">
                                            $350
                                        </span>
                                    </a>
                                    <span class="product-description">
                                        Xbox One Console Bundle with Halo Master Chief Collection.
                                    </span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="fbLogin" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12 col-xs-12 col-sm-12 text-center fbLoginMessage">

                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 col-xs-12 col-sm-12 text-center">
                        <button class="btn btn-primary" onclick="Login();">Login facebook</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="fanpageModel" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Chọn fanpage</h4>
            </div>
            <div class="modal-body">
                <input type="hidden" id="maxFanSelected" value="2" />
                <div class="row">
                    <div class="col-md-12 errorMessageContent">

                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 col-xs-12 col-sm-12">
                        <ul class="list-group" id="listFanpage">
                            <li class="list-group-item">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input">
                                    <label class="form-check-label">Check me out</label>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 col-xs-12 col-sm-12" id="fanpageContent">

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="saveFanpage" class="btn btn-primary">Lưu</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Hủy</button>
            </div>
        </div>

    </div>
</div>
@section script {

    <script>
        window.fbAsyncInit = function () {
            FB.init({
                appId: '828442780587442',
                cookie: true,
                xfbml: true,
                version: '3.1'
            });

            FB.AppEvents.logPageView();

        };

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) { return; }
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>
<script>

        var clientID = '1982143715396700';
        var clientSecrect = '5540cd3053d10b13bc4e482840db5836';

</script>
<script>
        //-----------
        // Show list of fanpage modal
        //-----------
        $('#selectFanpage1').click(function (e) {
            if (fbID === '') {
                $('#fbLogin').modal('show');
            }
            else {
                getFanpageData(fbID, fbToken);
                $('#fanpageModel').modal('show');
            }
        });
        //-----------
        // Get list of fanpage selected, save to database
        //-----------
        $('#saveFanpage').click(function (e) {
            $.each($('input.selectFanpage:checked'), function (idx, item) {
                $.ajax({
                    url: '/fb/Fanpage/SetFacebookUserInfor',
                    type: 'GET',
                    contentType: 'application/json',
                    dataType: 'json',
                    data: { fbUserID: fbUserID, fbUsername: fbUsername, token: token, expiredTime: expiredTime },
                    success: function (result) {
                        fbID = fbUserID;
                        $('#fbLogin').modal('hide');
                        return 1;
                    },
                    error: function (eror) {
                        $('.fbLoginMessage').empty();
                        $('.fbLoginMessage').html('<div class="alert alert-danger" role="alert">Đăng nhập không thành công</div>');
                        return -1;
                    }
                });
            });
            //fanpagInfo($('#fanID').val());
            return;

        });

        $(document).on('click', '.selectFanpage', function (e) {
            if ($('input.selectFanpage:checked').length > parseInt($('#maxFanSelected').val())) {
                showAlertWaring('errorMessageContent', 'Bạn chỉ được chọn tối đa ' + $('#maxFanSelected').val() + ' fanpage', 'warning');
                e.preventDefault();
            }
        });

        function setFacebookUserInfo(fbUserID, fbUsername, token, expiredTime) {
            $.ajax({
                url: '/fb/Fanpage/SetFacebookUserInfor',
                type: 'GET',
                contentType: 'application/json',
                dataType: 'json',
                data: { fbUserID: fbUserID, fbUsername: fbUsername, token: token, expiredTime: expiredTime },
                success: function (result) {
                    fbID = fbUserID;
                    $('#fbLogin').modal('hide');
                    return 1;
                },
                error: function (eror) {
                    $('.fbLoginMessage').empty();
                    $('.fbLoginMessage').html('<div class="alert alert-danger" role="alert">Đăng nhập không thành công</div>');
                    return -1;
                }
            });
        }





        //-----------
        // Show list of fanpage modal
        //-----------
        $('#selectFanpage').click(function (e) {
            if (fbID === '') {
                $('#fbLogin').modal('show');
            }
            else {
                getFanpageData(fbID, fbToken, displayListOfFanpage);
            }
        });

        //-----------
        // Display list of fanpage into modal after get from graph api
        //-----------
        function displayListOfFanpage(response) {
            console.log(response);
            var pages = response.accounts.data;
            var dRow = '';
            $.each(pages, function (idx, item) {
                dRow += '<li class="list-group-item">';
                dRow += '	<div class="form-check">';
                dRow += '		<input type="checkbox" class="form-check-input selectFanpage" data-id="' + item.id + '" data-name="' + item.name + '" data-token="' + item.access_token + '">';
                dRow += '		<label class="form-check-label">' + item.name + '</label>';
                dRow += '	</div>';
                dRow += '</li>';
            });
            $('#listFanpage').empty();
            $('#listFanpage').append(dRow);
            $('#fanpageModel').modal('show');
        }

        //-----------
        // save fanpage
        //-----------
        function saveFanpage(id, name, token, expireTime) {
            loading();
            var model = {
                FanpageId: id,
                DisplayName: name,
                Token: token,
                ExpiredTime: expireTime,
                ManagerID: fbID,
                Insert: True
            };
            $.ajax({
                url: '/fb/Fanpage/savefanpage',
                type: 'POST',
                contentType: 'application/json',
                dataType: 'json',
                data: JSON.stringify(model),
                success: function (result) {
                    showAlertWaring('msgErrorLog', 'Đã lưu fanpage: ' + name, 'success');
                    removeLoading();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    if (xhr.status == 401 || xhr.status == 530) {
                        window.location.href = '/forbiden';
                    }
                    showAlertWaring('msgErrorLog', 'lỗi khi xóa fanpage', 'error');
                    console.log(error);
                    removeLoading();
                }
            });
        }

        //-----------
        // Remove fanpage out owner list
        //-----------
        function deleteFanpage(id) {
            loading();
            var model = {
                Id: id
            };
            $.ajax({
                url: '/fb/Fanpage/deletefanpage',
                type: 'POST',
                contentType: 'application/json',
                dataType: 'json',
                data: JSON.stringify(model),
                success: function (result) {
                    showAlertWaring('msgErrorLog', 'Fanpage đã được xóa', 'success');
                    removeLoading();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    if (xhr.status == 401 || xhr.status == 530) {
                        window.location.href = '/forbiden';
                    }
                    showAlertWaring('msgErrorLog', 'lỗi khi xóa fanpage', 'error');
                    console.log(error);
                    removeLoading();
                }
            });
        }


        //demo callback function
        // onclick="click01(logSuccess);"
        function click01(callback) {
            console.log('click 01');
            $.ajax({
                url: '/home/ajaxlogin',
                type: 'get',
                dataType: 'json',
                async: true,
                contentTyp: 'application/json',
                success: callback,
                error: function (e, xhr) {
                }
            }).done(function (response) {
                console.log('done 1');
            });
        }

        function logSuccess(response) {
            console.log('success');
        }

</script>
}


